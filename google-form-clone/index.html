<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <style>
      body {
        margin: 0;
        background-color: #f8ede6;
      }
      .banner {
        background-image: url('./yuriy-chemerys-1428481-unsplash.jpg');
        background-size: cover;
        background-position: center;
        height: 278px;
      }
      .form {
        font-family: Roboto,RobotoDraft,Helvetica,Arial,sans-serif;
      }
      .form__view {
        max-width: 640px;
        margin: -100px auto 48px;
        padding: 34px 0;
        box-shadow: 0 1px 4px 0 rgba(0,0,0,0.37);
        box-sizing: border-box;
        background-color: #fff;
        border-top: 8px solid  rgb(132, 99, 78);
      }
      .form__header {
        margin-bottom: 22px;
      }
      .form__header-title-row {
        padding: 0 34px;
      }
      .form__header-title {
        font-size: 34px;
        margin: 0;
      }
      .form__header-description {
        font-size: 13px;
        margin-top: 22px;
        padding: 0 34px;
      }
      .form__header-required-legend {
        font-size: 13px;
        padding: 0 34px;
        color: #db4437;
      }
      .form__item-list {
        padding: 0 17px;
      }
      .form__item-list-item {
        margin-top: 2px;
        padding: 16px 17px;
      }
      .form__item-list-item.has-error {
        background-color: #ffebee;
      }
      .form__navigation {
        padding: 0 34px;
      }
      .form__navigation-submit-button {
        margin-top: 34px;
      }
      .form__navigation-warning {
        margin-top: 8px;
        color: rgba(0,0,0,0.54);
        font-size: 12px;
      }
      .form__item-list-item-title {
        font-size: 20px;
      }
      .form__item-list-item-help-text {
        font-size: 13px;
      }
      .form__item-list-item-input {
        position: relative;
        top: 14px;
        height: 40px;
        padding: 8px 8px 8px 0;
      }
      .form__item-list-item.has-error input {
        border-bottom: 1px solid #db4437;
      }
      .form__item-list-item-input > input {
        font-size: 16px;
        border-style: none;
        border-bottom: 1px solid rgba(0,0,0,0.12);
        color: rgba(0,0,0,0.87);
        padding-bottom: 2px;
      }
      .form__item-list-item-input > input[type=text] {
        width: 50%;
        background-color: transparent;
      }
      .form__item-list-item-input > input[type=text]:focus {
        border-bottom: 2px solid #db4437;
        outline: none;
      }
      .form__item-list-item-required-asterisk {
        color: #db4437;
        
      }
      .form__item-list-item-radio {
        padding: 8px 8px 8px 0;
      }
      .form__item-list-item-radio:first-child {
        margin-top: 8px;
      }
      .form__item-list-item-error-message {
        color: #db4437;
      }
      .form__navigation-submit-button > input[type=submit] {
        background-color: #4285f4;
        color: #fff;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 14px;
        min-width: 88px;
        min-height: 36px;
      }
      @media screen and (max-width: 660px) {
        .banner {
          height: 122px;
        }
        .form__view {
          width: 90%;
        }
      }
      @media screen and (min-width: 661px) {
        .banner {
          height: 278px;
        }
      }
      @media screen and (max-width: 480px) {
        .form__header-title {
          font-size: 24px;
        }
        .form__item-list-item-input > input[type=text] {
          width: 100%;
        }
      }      
    </style>
  </head>
  <body>
    <div class="banner">

    </div>
    <div class="form">
      <form>
        <div class="form__view">          
          <div class="form__header">
            <div class="form__header-title-row">
              <h1 class="form__header-title">程式導師實驗計畫第二期報名表單</h1>
            </div>            
            <div class="form__header-description">
              <p>詳情請參考：<a href="https://medium.com/hulis-blog/mentor-program-s2-f876c4e13d3b" target="_blank" rel="noopener">https://medium.com/hulis-blog/mentor-program-s2-f876c4e13d3b</a></p>
              <p>填完之後請務必按照文章內的說明再寄信給我，才算報名成功喔</p>
            </div>
            <div class="form__header-required-legend">
              <p>*必填</p>
            </div>            
          </div>
          <div class="form__item-list">
            <div data-item-id="1" class="form__item-list-item">
              <div class="form__item-list-item-title">電子郵件地址 <span class="form__item-list-item-required-asterisk">*</span></div>
              <div class="form__item-list-item-input"><input type="text" placeholder="你的電子郵件"></div>
            </div>
            <div data-item-id="2" class="form__item-list-item">
              <div class="form__item-list-item-title">暱稱 <span class="form__item-list-item-required-asterisk">*</span></div>
              <div class="form__item-list-item-help-text">該如何稱呼你</div>
              <div class="form__item-list-item-input"><input type="text" placeholder="您的回答"></div>
            </div>
            <div data-item-id="3" class="form__item-list-item">
              <div class="form__item-list-item-title">報名類型 <span class="form__item-list-item-required-asterisk">*</span></div>
                <div class="form__item-list-item-radio">
                  <input type="radio" id="basic-level" name="level" value="basic-level">
                  <label for="basic-level">從零到一基礎班（一個月後開始收保證金 3000，淘汰不退還，結業後兩個月內找到工作付一個月半薪水，沒工作不用付）</label>
                </div>
                <div class="form__item-list-item-radio">
                  <input type="radio" id="advanced-level" name="level" value="advanced-level">
                  <label for="advanced-level">在職工程師加強班（一個月後開始收保證金 3000，兩個月時收學費 30000，被淘汰不退還）</label>
                </div>
            </div>
            <div data-item-id="4" class="form__item-list-item">
              <div class="form__item-list-item-title">現在的職業 <span class="form__item-list-item-required-asterisk">*</span></div>
              <div class="form__item-list-item-help-text">範例：學生、前端工程師、待業中、業務</div>
              <div class="form__item-list-item-input"><input type="text" placeholder="您的回答"></div>
            </div>
            <div data-item-id="5" class="form__item-list-item">
              <div class="form__item-list-item-title">是否有程式相關背景？ <span class="form__item-list-item-required-asterisk">*</span></div>
              <div class="form__item-list-item-help-text">範例：無、高中時候學過C++、學過一點網頁前端、目前在資策會上課...</div>
              <div class="form__item-list-item-input"><input type="text" placeholder="您的回答"></div>
            </div>
            <div data-item-id="6" class="form__item-list-item">
              <div class="form__item-list-item-title">其他</div>
              <div class="form__item-list-item-help-text">任何你想說的</div>
              <div class="form__item-list-item-input"><input type="text" placeholder="您的回答"></div>
            </div>
          </div>
          <div class="form__navigation">
            <div class="form__navigation-submit-button">
              <input type="submit" value="提交">
            </div>
            <div class="form__navigation-warning">
              <p>請勿利用 Google 表單送出密碼。</p>
            </div>
          </div>
               
        </div>
      </form>
    </div>
    <script>
      var model = {
        itemList: [
          {
            'item_id': 1,
            'question': '電子郵件地址',
            'answer': '',
            'visited': false,
            'required': true,
          },
          {
            'item_id': 2,
            'question': '暱稱',
            'answer': '',
            'visited': false,
            'required': true,
          },
          {
            'item_id': 3,
            'question': '報名類型',
            'answer': '',
            'visited': false,
            'required': true,
          },
          {
            'item_id': 4,
            'question': '現在的職業',
            'answer': '',
            'visited': false,
            'required': true,
          },
          {
            'item_id': 5,
            'question': '是否有程式相關背景？',
            'answer': '',
            'visited': false,
            'required': true,
          },
          {
            'item_id': 6,
            'question': '其他',
            'answer': '',
            'visited': false,
            'required': false,
          }
        ]
      }
      var controller = {
        init: function() {
          view.init();
        },
        getNotAnswerItemList: function() {
          return model.itemList.filter(item => item.required && !item.answer).map(item => item.item_id);
        },
        getItem: function(id) {
          let resultList = model.itemList.filter(item => item.item_id == id);
          if (resultList.length > 0) {
            return resultList[0];
          } else {
            return null;
          }
        },
        exportData: function() {
          let data = {}
          let questions = model.itemList.map(item => item.question);
          let answers = model.itemList.map(item => item.answer);
          return questions.join(',') + '\n' + answers.join(',');
        },
        setItemVisited: function(id) {
          let self = this;
          let item = self.getItem(id);
          if (item) {
            item.visited = true;
          }
        },
        setItemContent: function(id, content) {
          let self = this;
          let item = self.getItem(id)
          if (item) {
            item.answer = content;
          }
        },
        getItemInputElement: function(id) {
          for (let itemInputElem of view.itemInputElemList) {
            if (itemInputElem.parentNode.parentNode.getAttribute('data-item-id') == id) {
              return itemInputElem;
            }
          }
          return null;
        },
        getItemElement: function(id) {
          for (let itemElem of view.itemElemList) {
            if (itemElem.getAttribute('data-item-id') == id) {
              return itemElem;
            }
          }
          return null;
        }
      }
      var view = {
        init: function() {
          let self = this;
          self.itemElemList = document.querySelectorAll('.form__item-list-item');
          self.itemInputElemList = document.querySelectorAll('.form__item-list-item-input > input[type=text]');
          self.itemRadioElemList = document.querySelectorAll('.form__item-list-item-radio > input[type=radio]');
          self.submitElem = document.querySelector('.form__navigation-submit-button > input[type=submit]');
          self.initInputElement();
          self.initSubmitElement();         
          self.render();
        },
        render: function() {
          let self = this;
          for (let itemId of controller.getNotAnswerItemList()) {
            let item = controller.getItem(itemId);
            if (item && item.visited) {
              self.addHasErrorClass(itemId, '這是必填問題');
            }           
          }
        },
        addHasErrorClass: function(id, errorMessage) {
          let self = this;
          let itemElem = controller.getItemElement(id);
          if (itemElem) {
            itemElem.classList.add('has-error');
            let errorMessageElem = self.getErrorMessageElement(itemElem)
            if (!errorMessageElem) {
              errorMessageElem = self.createErrorMessageElement(errorMessage);
              itemElem.appendChild(errorMessageElem);
            } else {
              errorMessageElem.innerText = errorMessage;
            }  
          }          
        },
        removeHasErrorClass: function(id) {
          let self = this;
          let itemElem = controller.getItemElement(id);
          if (itemElem) {
            let errorMessageElem = self.getErrorMessageElement(itemElem);
            if (errorMessageElem) {
              itemElem.removeChild(errorMessageElem);
            }            
            itemElem.classList.remove('has-error');
          }
        },
        createErrorMessageElement: function(errorMessage) {
          let errorMessageElem = document.createElement('div');
          errorMessageElem.innerText = errorMessage;
          errorMessageElem.classList.add('form__item-list-item-error-message');
          return errorMessageElem;
        },
        getErrorMessageElement: function(itemElem) {
          for (let i = 0; i < itemElem.children.length; i++) {
            if (itemElem.children[i].classList.contains('form__item-list-item-error-message')) {
              return itemElem.children[i];
            }
          }
          return null;
        },
        verifyEmailAddress: function(email) {
          let emailRule = /^\w+((-\w+)|(\.\w+))*@[a-zA-Z0-9]+((\.|-)[a-zA-Z0-9])*\.[a-zA-Z]+$/;
          return email.match(emailRule);
        },
        initInputElement: function() {
          let self = this;
          for (let itemInputElem of self.itemInputElemList) {
            itemInputElem.addEventListener('blur', e => {
              let itemElem = itemInputElem.parentNode.parentNode;
              let itemId = itemElem.getAttribute('data-item-id');
              controller.setItemVisited(itemId);
              if (itemId == 1 && itemInputElem.value && !self.verifyEmailAddress(itemInputElem.value)) {
                self.addHasErrorClass(itemId, '請輸入有效的電子郵件地址');
                return;
              }
              controller.setItemContent(itemId, itemInputElem.value);
              self.removeHasErrorClass(itemId);
              self.render();
            });
          }
          let emailElem = self.itemInputElemList[0];
          emailElem.addEventListener('keypress', e => {
            if (self.verifyEmailAddress(emailElem.value)) {
              self.removeHasErrorClass(emailElem.parentNode.parentNode.getAttribute('data-item-id'));
            }
          });          
        },
        initSubmitElement: function() {
          let self = this;
          self.submitElem.addEventListener('click', e => {
            e.preventDefault();
            let itemId = self.itemRadioElemList[0].parentNode.parentNode.getAttribute('data-item-id');
            self.initRadioElement(itemId);
            let notAnswerItemList = controller.getNotAnswerItemList()
            for (let itemId of notAnswerItemList) {
              let item = controller.getItem(itemId);
              self.addHasErrorClass(itemId, '這是必填問題');          
            }
            self.render();
            if (notAnswerItemList.length === 0) {
              console.log(controller.exportData());
            }            
          });
        },
        initRadioElement: function(itemId) {
          let self = this;
          for (let itemRadioElem of self.itemRadioElemList) {
            itemRadioElem.addEventListener('click', e => {
              self.removeHasErrorClass(itemId);
            });
            if (itemRadioElem.checked) {
              let elemId = itemRadioElem.getAttribute('id');
              let labelElem = document.querySelector('.form__item-list-item-radio > label[for=' + elemId + ']');
              controller.setItemVisited(itemId);
              controller.setItemContent(itemId, labelElem.innerText);
              break;
            }
          }
          if (!document.querySelector('input[name=level]:checked')) {
            self.addHasErrorClass(itemId, '這是必填問題');
          }
        }
      }
      controller.init();
    </script>
  </body>
</html>